<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从浏览器地址栏输入url开始 | 学习笔记</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/xm.png">
    <meta name="description" content="学习笔记">
    <link rel="preload" href="/assets/css/0.styles.bfe5e6bb.css" as="style"><link rel="preload" href="/assets/js/app.37ebde6a.js" as="script"><link rel="preload" href="/assets/js/2.955597d0.js" as="script"><link rel="preload" href="/assets/js/9.f4b98db2.js" as="script"><link rel="prefetch" href="/assets/js/3.823b1e2d.js"><link rel="prefetch" href="/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/assets/js/5.c7d738d4.js"><link rel="prefetch" href="/assets/js/6.41dcb235.js"><link rel="prefetch" href="/assets/js/7.0877ee37.js"><link rel="prefetch" href="/assets/js/8.81ac1592.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bfe5e6bb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/xm.png" alt="学习笔记" class="logo"> <span class="site-name can-hide">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://github.com/Somefuture" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://github.com/Somefuture" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">首页</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>九月</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/sept/url-action.html" aria-current="page" class="active sidebar-link">第一篇：从浏览器地址栏输入url开始</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/sept/deep-clone.html" class="sidebar-link">第二篇：走进lodash深拷贝</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>目录：
</p><div class="table-of-contents"><ul><li><a href="#要点总结">要点总结</a></li><li><a href="#详细解析">详细解析</a></li><li><a href="#http状态码">http状态码</a></li><li><a href="#http和https的区别">http和https的区别</a></li><li><a href="#http缓存">http缓存</a></li><li><a href="#http1-0-到-http1-1-到http2-0">http1.0 到 http1.1 到http2.0</a></li><li><a href="#link-preload-的好处">link preload 的好处</a></li><li><a href="#gpu-web性能优化">GPU&amp;web性能优化</a></li><li><a href="#如何减少页面的回流">如何减少页面的回流</a></li><li><a href="#requestanimationframe-和-settimeout区别">requestAnimationFrame 和 setTimeout区别</a></li><li><a href="#重绘与回流">重绘与回流</a></li></ul></div><p></p> <h3 id="要点总结"><a href="#要点总结" class="header-anchor">#</a> 要点总结</h3> <ol><li>DNS解析：将域名解析成IP地址</li> <li>建立TCP连接：TCP三次握手</li> <li>TLS协商（仅https请求）</li> <li>发送HTTP请求</li> <li>服务器处理请求并返回HTTP报文</li> <li>浏览器解析渲染页面</li> <li>断开连接：TCP四次挥手</li></ol> <h3 id="详细解析"><a href="#详细解析" class="header-anchor">#</a> 详细解析</h3> <ol><li><p>url的定义（Uniform Resource Locator 统一资源定位符），用于定位互联网上的资源，以下面这个为例：</p> <div class="language-s extra-class"><pre class="language-text"><code>  http://www.example.com:80/path/to/myfile.html?key1=value1&amp;key2=value2#SomewhereInTheDocument
</code></pre></div><ul><li><p><code>http</code>是协议。它表明了浏览器必须使用哪一种协议，通常为http协议和https协议。<a href="#http%E5%92%8Chttps%E7%9A%84%E5%8C%BA%E5%88%AB">http和https的区别</a>
web浏览器中常见的是这种，浏览器也知道如何处理其他协议，比如：<code>mailto:(打开邮件客户端)</code>或者<code>ftp:(处理文件传输)</code></p></li> <li><p><code>www.example.com</code>是域名。它表明正在请求哪个web服务器。或者可以直接使用IP address。DNS（DomainName System 域名系统）的作用就是将域名映射到服务对应的ip地址。</p></li> <li><p><code>80</code>是端口。它表示用于访问web服务器伤的资源的技术“门”。如果web服务没有特别指出端口，则使用HTTP协议的默认端口（HTTP：80，HTTPS：443）。</p></li> <li><p><code>/path/to/myfile.html</code>是网络服务器上资源的路径。在web的早起阶段，这种路径表示web服务器上物理文件的位置。但是如今，它主要是由没有任何物理实现的web服务器处理的抽象。例如单页面应用的路径并不能表示物理位置，而是运行js代码加载的相对应的资源。</p></li> <li><p><code>?key1=value1&amp;key2=value2</code>是提供给网络服务器的额外参数。在返回资源之前，web服务器可以使用这些参数来执行额外的操作。</p></li> <li><p><code>#SomewhereInTheDocument</code>是资源身的另一部分的锚点，表示资源中的一种“书签“。比如：在html文档上，浏览器将滚动到定义锚点的位置；在视屏音频文档上，浏览器将尝试转到锚点所代表的时间。且：#后面的内容（片段标志符）不会被发送到请求的服务器,以下图为例，刷新该地址，http请求中并不会将锚点后的内容向服务器进行请求。</p></li></ul> <p><img src="/images/url.png" alt="url"> <img src="/images/http.png" alt="http请求"></p></li> <li><p>域名与DNS(DomianName System)</p> <ul><li><p>域名为互联网可用的网页服务器提供了方便人类理解的地址。当你在注册商那注册了一个域名，几个小时内，所有的DNS服务器都会收到你的DNS信息。我们在访问一个域名的时候，通常会向网络服务商的最底层的DNS服务器查询域名，如果没有查询到，就会去上一级的服务器查询，一直到从顶级服务器中查询到你的域名为止。并且这个结果，会缓存在底层的DNS服务器里。</p></li> <li><p>DNS请求的工作流程：</p> <div class="language-s extra-class"><pre class="language-text"><code>1. 在你的浏览器地址栏输入baidu.com
2. 浏览器询问计算机是否已经已经识别此域名所确定的IP地址（使用本地DNS缓存）。
   如果是的话，这个域名就会被转换为IP地址，然后浏览器与网络服务器交换内容，结束域名解析流程。
3. 如果你的计算机不知道baidu.com域名背后的IP,它会询问一个DNS服务器，这个服务器的功能就是告诉你的计算机已经注册的域名所匹配的IP.
4. 然后计算机就知道了要请求的IP地址，你的浏览器能够与网络服务器建立连接
</code></pre></div></li></ul></li> <li><p>TCP握手</p> <p>握手过程：</p> <div class="language-s extra-class"><pre class="language-text"><code>1. 客户端发送一个带SYN=1，Seq=X的数据包到服务器端口（第一次握手，由浏览器发起，告诉服务器我要发送请求了）
2. 服务器收到这个数据包之后，发回一个带SYN=1,ACK=X+1,Seq=Y的响应包，传达确认信息（第二次握手，由服务器发起，告诉浏览器我准备接受请求了，你可以发送了）
3. 客户端再回传一个带ACK=Y+1,Seq=Z的数据包，代表“握手结束”，连接建立成功，开始数据传输（第三次握手，由浏览器发送，告诉服务器，我马上就发了，准备接受吧）
</code></pre></div><p>三次握手的原因：</p> <div class="language-s extra-class"><pre class="language-text"><code>为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误。
</code></pre></div></li> <li><p>TLS协商。为了在https上建立安全连接，我们需要进行TLS协商。它会决定服务端和客户端进行通信加密使用的秘钥，传播公钥时使用的是非对称加密，然后传输数据时，使用对称加密。</p></li> <li><p>在浏览器和服务器之间，有许多的计算机和其它设备转发了http消息，比如你的路由器、网线。这些主要出现在传输层、网络层和物理层上，所以你的宽带网速，也很大程度上的影响了你网页的加载速度。但是在这中间，我们可能会通过代理，去向服务器请求我们需要的资源。目前适用范围最广的代理是：nginx。</p> <p>nginx代理服务器的主要作用：</p> <ul><li>缓存，但是当cache control: privite时，不允许代理服务器进行缓存</li> <li>过滤（像反病毒扫描，家长控制）</li> <li>负载均衡（让多个服务器服务不同的请求）</li> <li>认证（对不同资源进行权限管理）</li> <li>日志记录（允许存储历史信息）</li></ul></li> <li><p>http请求</p> <p>一旦我们建立了到web服务器的连接，浏览器就代表用户发送了一个初始的HTTP GET请求，对于网站来说，这个请求通常是一个HTML文件。一旦服务器收到请求，它将使用相应的响应头和html的内容进行回复。</p></li> <li><p>TCP慢开始/14kb规则。 第一个响应包的大小是14kb。这是慢开始的一部分，慢开始是一种均衡网络连接速度的算法，慢开始逐渐增加发送数据的数量直到达到网络的最大带宽。在收到初始包之后，服务器会将下一个包的大小加倍到28kb，然后后续包依次是前一个包大小的2倍，直到到达预定的阈值或者遇到堵塞。</p></li> <li><p>一旦浏览器收到数据的第一块，它就可以开始解析收到的信息。这就是为什么在前14kb中包含浏览器开始渲染页面所需的所有内容，至少包含页面模板（第一次渲染所需的css和html）对于web性能优化来说至关重要。</p></li> <li><p>浏览器解析过程：</p> <ul><li><p>处理HTML标签并构造DOM树。良好的文档格式，有利于加快dom树的解析速度。dom节点的数量越多，构建dom树需要的时间就越长。DOM树解析的过程是一个深度优先遍历，会先构建初当前节点的所有字节点，再构建下一个兄弟节点。</p></li> <li><p>当解析器发现非阻塞资源例如图片或者css文件时，解析也可以继续进行。但是对于<code>&lt;script&gt;</code>标签(特别说没有async或者dfer属性的script标签),会阻塞渲染并停止HTML的解析。可以使用<code>&lt;link rel=&quot;preload&quot; href=&quot;main.js&quot; as=&quot;script&quot;&gt;</code> link的rel属性配置预加载，这样在随后的页面渲染中，一旦需要使用到它们，它们就立刻可用，不需要停止html解析</p></li> <li><p>接下来是处理css并构建CSSOM树。（尽量避免使用后代选择器，因为css树计算时，先匹配后代，再对父元素进行匹配，相对于具名类选择器来说，性能非常的差）</p></li> <li><p>当css被解析并创建COSSOM时，js文件被解释、编译和执行。脚本被解析为抽象语法树（Abstract Syntax Tree）.一些浏览器引擎使用AST并将其传递到解释器中，输出在主线程执行的字节码。这就是js编译的过程。</p></li> <li><p>浏览器还会构建辅助设备用户分析和解释内容的辅助功能树-可访问性对象模型（AOM）类似DOM的语义版本，这也是为什么我们在开发网页的时候，推荐使用语义化的标签，更加有利于构建清晰的可访问对象。在构建AOM之前，屏幕阅读器无法访问内容</p></li> <li><p>dom树和cssom树构造完毕以后，浏览器会将DOM树和cssom树组合成一个Render树，计算render树从dom树的根开始构建，遍历每个可见节点。（display:none的节点不会出现在render树上，visibility:hidden的节点会出现在render树上,且会占用空间）。render树会将所有相关样式匹配到dom树中的每个可见节点，并根据css的层级确定每个节点的样式。</p></li> <li><p>接下来是在渲染树上运行布局以计算每个节点的几何体。第一次确定节点的大小和位置称为布局。随后对节点的大小和位置的重新计算称为回流。为了确定每个DOM节点的确切大小和位置。浏览器会从渲染树的根开始遍历，因此布局和回流是十分耗费性能的。</p></li> <li><p>最后一步是将各个节点绘制到屏幕上。在绘制阶段，浏览器将把元素的每个可视化部分绘制到屏幕上。绘制可以将布局树中的元素分解为多个层，将内容提升到GPU上的层，可以提高绘制和重绘的性能。层的确可以提高性能，但是它以内存管理为代价。所以不应该过度使用。</p></li> <li><p>当文档的各个部分以不同的层绘制，互相重叠时，必须进行合成，以确保它们以正确的顺序绘制到屏幕上。</p></li> <li><p>一旦主线绘制页面完成，如果主线程正在解析、编译和执行js，则此时页面还是无法及时响应用户交互，当相关js执行完毕，页面进入可交互状态。</p></li> <li><p>到此，一个完整的页面加载完毕。为了不需要每请求一个http就要建立一个tcp连接，http1.1提出了HTTP keep-alive，只要任意一段没有明确提出断开连接，则保持TCP连接状态。</p></li> <li><p>在http1.0时期，http请求完毕，tcp连接关闭。开始四次挥手：</p> <ul><li>第一次挥手，由浏览器发起，告诉服务器：我请求报文发送完了，你准备关闭吧</li> <li>第二次挥手，由服务器发起，告诉浏览器：我请求报文接收完了，我准备关闭了，你也准备吧</li> <li>第三次挥手，由服务器发起，告诉浏览器：我响应报文发送完了，你准备关闭吧</li> <li>第四次挥手，由浏览器发起，告诉服务器：我响应报文接收完了，我准备关闭了，你也准备吧。然后服务器收到挥手后，关闭连接。然后浏览器还等待一定时间未收到回复，则正常关闭。</li></ul></li></ul></li></ol> <h3 id="http状态码"><a href="#http状态码" class="header-anchor">#</a> http状态码</h3> <h3 id="http和https的区别"><a href="#http和https的区别" class="header-anchor">#</a> http和https的区别</h3> <h3 id="http缓存"><a href="#http缓存" class="header-anchor">#</a> http缓存</h3> <h3 id="http1-0-到-http1-1-到http2-0"><a href="#http1-0-到-http1-1-到http2-0" class="header-anchor">#</a> http1.0 到 http1.1 到http2.0</h3> <h3 id="link-preload-的好处"><a href="#link-preload-的好处" class="header-anchor">#</a> link preload 的好处</h3> <ul><li>更加精确的优化资源加载优先级</li> <li>匹配未来的加载需求，在适当的情况下，重复利用同一资源</li> <li>为资源应用正确的内容安全策略</li> <li>为资源设置正确的Accept请求头</li></ul> <h3 id="gpu-web性能优化"><a href="#gpu-web性能优化" class="header-anchor">#</a> GPU&amp;web性能优化</h3> <h3 id="如何减少页面的回流"><a href="#如何减少页面的回流" class="header-anchor">#</a> 如何减少页面的回流</h3> <ul><li>事先设定好图片标签的大小，避免在图片加载完成后，获得图片大小触发回流</li></ul> <h3 id="requestanimationframe-和-settimeout区别"><a href="#requestanimationframe-和-settimeout区别" class="header-anchor">#</a> requestAnimationFrame 和 setTimeout区别</h3> <p><a href="https://juejin.im/entry/6844903600557129736" target="_blank" rel="noopener noreferrer">requestAnimationFrame<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="重绘与回流"><a href="#重绘与回流" class="header-anchor">#</a> 重绘与回流</h3></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/24/2020, 8:22:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/" class="prev router-link-active">
        首页
      </a></span> <span class="next"><a href="/sept/deep-clone.html">
        第二篇：走进lodash深拷贝
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.37ebde6a.js" defer></script><script src="/assets/js/2.955597d0.js" defer></script><script src="/assets/js/9.f4b98db2.js" defer></script>
  </body>
</html>
